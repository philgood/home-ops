---
# yaml-language-server: $schema=https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/main/jsonschema/prometheusrule.json
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: temperature-alerts
  namespace: observability
  labels:
    prometheus: kube-prometheus
    role: alert-rules
spec:
  groups:
    - name: temperature-monitoring
      interval: 30s
      rules:
        # K8s Nodes - NVMe Drive Temperature Alerts Only
        - alert: NodeHighNVMeTemperature
          expr: |
            node_hwmon_temp_celsius{instance=~"172\\.20\\.24\\.(10|11|12):9100", chip=~"nvme_nvme.*"} > 65
          for: 3m
          labels:
            severity: warning
            component: nvme
            notification_type: mqtt
          annotations:
            summary: "Node NVMe drive temperature elevated"
            description: "Node {{ $labels.instance }} NVMe drive {{ $labels.chip }} sensor {{ $labels.sensor }} is at {{ $value | humanize }}째C (threshold: 75째C)"
            
        - alert: NodeCriticalNVMeTemperature
          expr: |
            node_hwmon_temp_celsius{instance=~"172\\.20\\.24\\.(10|11|12):9100", chip=~"nvme_nvme.*"} > 85
          for: 1m
          labels:
            severity: critical
            component: nvme
            notification_type: mqtt
          annotations:
            summary: "CRITICAL Node NVMe drive temperature"
            description: "Node {{ $labels.instance }} NVMe drive {{ $labels.chip }} sensor {{ $labels.sensor }} is at {{ $value | humanize }}째C (threshold: 85째C) - immediate attention required!"